\chapter{Background}\label{chap:background}

This background section will explain some of the concepts, approaches, technologies and software architectures required to understand this thesis.
The findings from the pre-project in \cite{rekstadModelingEnvironmentCloud2020} will also be presented in more detail than the introduction, as the findings are central to this thesis.
Lastly, a section on open source software project management follows, as they shape many of the choices made in the implementation of a solution.

\section{Conceptual Modeling and Model-Driven Development}\label{sec:conceptual-modeling}

\input{chapters/3-background/1-mdd.tex}


\section{Model-Driven Development at NTNU in the Course TDT4250}\label{sec:tdt4250}

\input{chapters/3-background/2-tdt4250.tex}


\section{Eclipse Modeling Framework Editors for Ecore}\label{sec:emf-editors}

\input{chapters/3-background/3-emf-editors.tex}


\section{Introduction to Tree Structures}\label{sec:tree-structures}

\input{chapters/3-background/4-trees.tex}


\section{Master-Detail Tree Editor}\label{sec:master-detail}

\input{chapters/3-background/5-master-detail.tex}


\section{The Eclipse Reflective Ecore Editor}

* Reflective Ecore Editor, its architecture, Commands in .Edit, works on any model.
* Adaptation of editors to special cases like Ecore model and Genmodel.
% TODO: remove? DUplicate of prev. section?

\section{An Overview of EMF:\ Ecore Metamodel, XMI Serialization and GenModel for Code Generation}\label{sec:emf-metamodel}

\input{chapters/3-background/6-emf.tex}

\section{Visual Studio Code and Theia}

\input{chapters/3-background/7-vscode.tex}


\section{Visual Studio Code's Custom Editor API}\label{sec:vscode-custom-editor}

\input{chapters/3-background/8-custom-editor.tex}


\section{Language Server Protocol Architecture}\label{sec:lsp}

\input{chapters/3-background/9-lsp.tex}


\section{JSON-RPC}\label{sec:json-rpc}

\input{chapters/3-background/10-json-rpc.tex}


\section{\Gls{cloud} and \gls{Gitpod}}

\input{chapters/3-background/10-cloud-gitpod.tex}


\section{\acrlong{EMF} in the \Gls{cloud}}\label{sec:emf-in-cloud}

\paragraph{The Eclipse Cloud Development project}
As mentioned in the introduction (\cref{sec:intro-eclipse-cloud}), the Eclipse ecosystem is interested in running software in the \gls{cloud}.
This means that they have spent the last few years creating tools to support \gls{cloud} oriented deployments for software built on \acrlong{EMF}.
The Eclipse Foundation has an umbrella project called \textit{Eclipse Cloud Development}.
In the Eclipse Foundation, a project is not a single codebase, but rather a home for frameworks, tools and components.
Under this umbrella exists projects like \textit{EMF.Cloud}, \textit{Eclipse Che}, \textit{Eclipse GLSP}, \textit{Eclipse Theia}, \textit{Eclipse OpenVSX} and more~\cite{beatonEclipseCloudDevelopment2014}.

\subsection{EMF.Cloud}
The Eclipse ecosystem found it suitable to create a new project under this umbrella, and called it \textit{Eclipse EMF.Cloud}.
The description for Eclipse EMF.Cloud starts with the following:
\begin{quote}
  ``\textit{Eclipse EMF.cloud comprises a set of components that facilitate and simplify the adoption of the Eclipse Modeling Framework (EMF) in cloud-based applications.\\
  \textelp{}\\
  As a consequence, by its nature, EMF.cloud is open to any software project that aims to address the challenges and specific requirements of using any aspect of EMF in a browser-based setting or cloud deployment.}''\\
  ---~\textcite{smithEclipseEMFCloud2019}
\end{quote}

\paragraph{EMF.Cloud software}
The components provided by EMF.Cloud are still in active development.
Most of them center around building a modeling environment in \gls{Theia}, for existing \acrshort{EMF} models.
The example case that is used is a ``Coffee brewing model''.
Because much of the work targets Theia, the Eclipse ecosystem uses Theia Extensions.
This means they can not be used in \gls{Gitpod}, because the \acrshort{IDE} has to be replaced with their customized Theia.
However, much of the work here is still relevant, as components to use in a \gls{VSCode} extension, and as design to draw inspiration from.\\

The EMF.Cloud project currently provides these components, according to \cite{tobiasortmayrEclipseemfcloudEmfcloud2021}:

\begin{itemize}
  \item modelserver
  \item modelserver-theia
  \item model-validation
  \item coffee.editor
  \item ecore-glsp
  \item theia-tree-editor
  \item json-forms-property-view
  \item modelserver-glsp-integration
  \item emf-jackson
\end{itemize}

The most relevant components for this thesis are detailed in the following subsections.

\subsubsection{Model Server}
The EMF.Cloud Model Server provides a web server for working with \acrshort{EMF} models.
While \acrshort{EMF} already support model loading, manipulation and serialization in the \acrshort{EMF} runtime \acrshort{API}, this server exposes these to the web.
It does so by providing a \gls{REST} \acrshort{API} for working with models, and \gls{WebSocket} channels for subscribing to change events.
The Model Server also manages a ``shared editing domain'' for the loaded models, and changes models using \acrshort{EMF} \texttt{Command}s~\cite{foundationEMFCloud}.\\

This Model Server is already used in other EMF.Cloud components, like the coffee editor and ecore-glsp~\cite{eugenneufeldEclipseemfcloudCoffeeeditor2021,ninadoschekEclipseemfcloudEcoreglsp2021}.

\subsubsection{Theia Tree Editor}
Theia Tree Editor is a framework for creating master-detail tree editors~\cite{foundationEMFCloud}.
It uses the Theia extension mechanism, and uses core components of \gls{Theia} itself~\cite{rekstadModelingEnvironmentCloud2020}.
This hinders reuse in other \acrshortpl{IDE} like \gls{VSCode}.
However, the data structures and configuration schemas used in the Theia Tree Editor are good sources for design inspiration.

\subsubsection{Coffee Editor}
The Coffee Editor is an example application, trying to demonstrate the use of EMF.Cloud components in a real \gls{cloud} deployment.
This editor uses \gls{Theia}, JSON-Forms, \acrshort{GLSP}, a code generator, and the Model Server~\cite{foundationEMFCloud}.
This editor is interesting because it applies the technologies, demonstrating their use, purpose and value.
It also demonstrates the use of a Model Server shared among multiple editing components, like the GLSP and Theia Tree Editor working on the same backing coffee \acrshort{EMF} model instances.

\subsection{Graphical Language Server Platform (GLSP)}\label{sec:glsp}

This is another project under the Eclipse Cloud Development project.
The \acrfull{GLSP} is a framework for building diagram editors in the web.
The editors can either be standalone or integrated into \gls{Theia} and \gls{VSCode}.
The \acrshort{GLSP} defines its own \acrfull{LSP} for diagrams~\cite{eclipsefoundationGLSP2020}.
A figure from the official website is shown in \cref{fig:glsp-overview}.\\

This is a good source of design inspiration, because it both works with \acrshort{EMF} models, and it applies the \acrlong{LSP} architecture to a new domain other than text editing.

\begin{figure}[htbp]  % order of priority: h here, t top, b bottom, p page
  \centering
  \includegraphics[width=\textwidth]{figures/pre-project/glsp-overview.png}
  \caption[GLSP Overview]{A diagram of GLSP. A web based diagram editor shows the diagram obtained from a Graphical Model Editor Client. This client talks to a graphical model server over the Graphical Language Server Protocol. Copied from \cite{eclipsefoundationGLSP2020}.}\label{fig:glsp-overview}
\end{figure}


\subsection{Other Tools by the Eclipse Ecosystem}
% TODO

\subsubsection{JSON-Forms}\label{sec:json-forms}
% TODO
* By EclipseSource.

\subsubsection{Crossecore}
% TODO
* Multiplatform, typescript codegen.
* Javascript EMF Runtime.

\subsubsection{ecore.js}
% TODO
* Under emfjson

%TODO
* Recent development, EMF.Cloud Model Server, EMF.Cloud EMFJson, GLSP, GLSP Ecore Editor (and ActionMessage\label{par:glsp-actionmessage}), GLSP Coffee Editor, JSON Forms.
Theia Tree Editor\label{par:theia-tree-editor} (source: \cref{EclipseemfcloudTheiatreeeditor2020}. Schemas and child mapping at \cref{EclipseemfcloudCoffeeeditor2021}. Tutorial: \cref{helmingHowBuildTree2021}) and coffee-example, for those able to compile Theia.

\section{Pre-project Results}

\input{chapters/3-background/11-pre-project-findings.tex}


\section{Open Source Software Project Management and Project Viability}

* What can make this Open Source software project viable and worth pursuing further? Anecdotal and empirical evidence, not research.
  * This project needs to live on after the delivery of the Thesis.
  * Correct open source licenses, and "license hygiene" wrt. copy-pasting. Eclipse Foundation do thorough license reviews.
  * Use of programming languages accepted by the developer community.
  * Use of automated build systems accepted by the developer community.
  * Testable code to reduce legacy and maintenance burden.
  * Human readable, clean code. Correct use of Design Patterns. Clean separation of concerns.
  * Use of commonly used and recognized dependencies/libraries/frameworks/tools.
  * CI/CD.
  * Good developer documentation. Architecture diagrams. Informative Readme-files with pictures of the running software. Instructions for developer environment setup.
  * Google Design Documents (?). Not too common in this ecosystem, but valuable inside Google. Complements the readme.
  * Publicly available bug/issue tracker and roadmap.
  * Release management. Semantic versioning. Changelogs. More useful for end-users or those using this as a library/dependency.
  * Specific to Eclipse Foundation, is the "Eclipse Foundation Project Handbook" (https://www.eclipse.org/projects/handbook/) and its checklist.
  * Measures to reduce new-developer onboarding and friction.
