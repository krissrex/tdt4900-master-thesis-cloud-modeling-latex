\chapter{Background}\label{chap:background}

This background section will explain some of the concepts, approaches, technologies and software architectures required to understand this thesis.
The findings from the pre-project in \cite{rekstadModelingEnvironmentCloud2020} will also be presented in more detail than the introduction, as the findings are central to this thesis.
Lastly, a section on open source software project management follows, as they shape many of the choices made in the implementation of a solution.

\section{Conceptual Modeling and Model-Driven Development}\label{sec:conceptual-modeling}

\input{chapters/3-background/1-mdd.tex}


\section{Model-Driven Development at NTNU in the Course TDT4250}\label{sec:tdt4250}
% * TDT4250. Modeling, use of instances to validate model as you develop, validation of models.

\input{chapters/3-background/2-tdt4250.tex}


\section{Eclipse Modeling Framework Editors for Ecore}\label{sec:emf-editors}

\input{chapters/3-background/3-emf-editors.tex}


\section{Introduction to Tree Structures}\label{sec:tree-structures}

\input{chapters/3-background/4-trees.tex}


\section{Master-Detail Tree Editor}\label{sec:master-detail}

\input{chapters/3-background/5-master-detail.tex}


\section{The Eclipse Reflective Ecore Editor}

* Reflective Ecore Editor, its architecture, Commands in .Edit, works on any model.
* Adaptation of editors to special cases like Ecore model and Genmodel.
% TODO: remove? DUplicate of prev. section?

\section{An Overview of EMF:\ Ecore Metamodel, XMI Serialization and GenModel for Code Generation}\label{sec:emf-metamodel}

\input{chapters/3-background/6-emf.tex}

\section{Visual Studio Code and Theia}

The two \acrshortpl{IDE} relevant for this thesis are Visual Studio Code (\gls{VSCode}) and \gls{Theia}.
Both are available as editors in \gls{Gitpod} as cloud based \acrshortpl{IDE}.

\subsection{Visual Studio Code}

\Gls{VSCode} is a very popular \gls{open source} \acrshort{IDE} created by Microsoft~\cite{stackoverflowStackOverflowDeveloper2019}.
A screenshot is shown in \cref{fig:vscode-ui}.
It uses web technologies like javascript, \gls{Nodejs} and \gls{Electron} to provide an advanced text editor and tools for programming on a desktop.
Originally made only for desktop, \gls{VSCode} was later adapted to also work in a browser when \gls{GitHub}\footnote{GitHub is owned by Microsoft.} launched Codespaces~\cite{svenefftingeProductRoadmapQ1}.
\Gls{VSCode} is extensible, and allows third party developers to create extensions.
These are distributed from Microsoft's extension store: Visual Studio Marketplace\footnote{Marketplace website: \href{https://marketplace.visualstudio.com/vscode}{\nolinkurl{https://marketplace.visualstudio.com/vscode}}.}.

\begin{figure}[htbp]  % order of priority: h here, t top, b bottom, p page
  \centering
  \includegraphics[width=\textwidth]{figures/pre-project/vscode-ui.png}
  \caption[VSCode User Interface]{The \gls{VSCode} user interface, annotation with the different components (A-E).}\label{fig:vscode-ui}
\end{figure}

\subsection{Theia}

Theia is based on the \gls{open source} components from \gls{VSCode}, without a proprietary component that Microsoft added for telemetry.
Theia is managed by the Eclipse Foundation, and was created to be web based from the start (before Codespaces launched, when \gls{VSCode} was desktop only).
A screenshot is shown in \cref{fig:theia-ui}.
The main uses of Theia are workspace services like \gls{Gitpod} and Eclipse Che, but it is also intended to be a ``web based version'' of the Eclipse Rich Client Platform.
This means tools can create their own distribution of Theia, where they are deeply integrated~\cite{helmingEclipseTheiaIDE2019a}.

\paragraph{Extensions}
Theia can load extensions using the same \acrfull{API} as \gls{VSCode}.
Theia calls these ``Theia Plugins''.
Another way to extend Theia is using ``Theia Extensions''.
These have full control over the \acrshortpl{IDE}, and can modify practically anything.
Installing a Theia Extension requires the user to perform a full compilation of \gls{Theia} itself~\cite{helmingHowAddExtensions2019}.
A Theia Plugin (or \gls{VSCode} extension) however, can be installed at runtime.


\begin{figure}[htbp]  % order of priority: h here, t top, b bottom, p page
  \centering
  \includegraphics[width=\textwidth]{figures/pre-project/theia-screenshot.png}
  \caption[Theia User Interface]{The \gls{Theia} user interface.}\label{fig:theia-ui}
\end{figure}

\section{Visual Studio Code's Custom Editor API}\label{sec:vscode-custom-editor}

A \gls{VSCode} extension is allowed to use a set of \acrlongpl{API} provided by \gls{VSCode}.
One such \acrshort{API} is the \textit{Custom Editor API}.
This allows an extension developer to create \textbf{custom editors other than text editors}.
This could be diagrams, pictures, graphs, or \textbf{trees}, for example.
The developer has the full freedom of a web browser, as they are given their own isolated frame.
Normally, an extension cannot modify the user interface outside of the provided \acrshortpl{API}.
This is in contrast to inside the provided \texttt{WebView}, where the developer has to \textit{create and manage} the entire user interface.
In addition to a user facing \texttt{WebView}, the developer must create their own document model.
By default, \gls{VSCode} uses a document model for text documents, with selections, edits, versions and more.
The \texttt{CustomDocument} only has a uri pointing to the file.
Another central part is the \texttt{CustomEditorProvider}, with a few methods to fill in, like opening, undoing and saving a document.


\section{Language Server Protocol Architecture}\label{sec:lsp}
%TODO
* LSP from VSCode solves language-to-editor m*n combinations. There is already a need to move EMF from Eclipse to VSCode, it might need to move to IntelliJ etc. in the future.
* Monaco general frontend. Also Eclipse uses LSP with JDT? IntelliJ??
* Base protocol \label{sec:base-protocol}

\section{JSON-RPC}
%TODO

\section{\Gls{cloud} and \gls{Gitpod}}

\input{chapters/3-background/10-cloud-gitpod.tex}


\section{\acrlong{EMF} in the \Gls{cloud}}\label{sec:emf-in-cloud}
%TODO
* Recent development, EMF.Cloud Model Server, EMF.Cloud EMFJson, GLSP, GLSP Ecore Editor (and ActionMessage\label{par:glsp-actionmessage}), GLSP Coffee Editor, JSON Forms.
Theia Tree Editor\label{par:theia-tree-editor} (source: \cref{EclipseemfcloudTheiatreeeditor2020}. Schemas and child mapping at \cref{EclipseemfcloudCoffeeeditor2021}. Tutorial: \cref{helmingHowBuildTree2021}) and coffee-example, for those able to compile Theia.

\section{Pre-project Results}

\input{chapters/3-background/11-pre-project-findings.tex}


\section{Open Source Software Project Management and Project Viability}

* What can make this Open Source software project viable and worth pursuing further? Anecdotal and empirical evidence, not research.
  * This project needs to live on after the delivery of the Thesis.
  * Correct open source licenses, and "license hygiene" wrt. copy-pasting. Eclipse Foundation do thorough license reviews.
  * Use of programming languages accepted by the developer community.
  * Use of automated build systems accepted by the developer community.
  * Testable code to reduce legacy and maintenance burden.
  * Human readable, clean code. Correct use of Design Patterns. Clean separation of concerns.
  * Use of commonly used and recognized dependencies/libraries/frameworks/tools.
  * CI/CD.
  * Good developer documentation. Architecture diagrams. Informative Readme-files with pictures of the running software. Instructions for developer environment setup.
  * Google Design Documents (?). Not too common in this ecosystem, but valuable inside Google. Complements the readme.
  * Publicly available bug/issue tracker and roadmap.
  * Release management. Semantic versioning. Changelogs. More useful for end-users or those using this as a library/dependency.
  * Specific to Eclipse Foundation, is the "Eclipse Foundation Project Handbook" (https://www.eclipse.org/projects/handbook/) and its checklist.
  * Measures to reduce new-developer onboarding and friction.
